<?xml version="1.0" encoding="UTF-8"?>
<?asciidoc-toc?>
<?asciidoc-numbered?>
<article xmlns="http://docbook.org/ns/docbook" xmlns:xl="http://www.w3.org/1999/xlink" version="5.0" xml:lang="en">
<info>
<title>jMQTT</title>
<date>2019-04-11</date>
</info>
<section xml:id="_présentation">
<title>Présentation</title>
<simpara>Ce plugin permet de connecter Jeedom à un broker MQTT comme Mosquitto afin de récupérer les messages souscrits et de publier ses propres messages.</simpara>
<simpara>MQTT est un protocole de communication sur IP, basé sur une architecture client/serveur et un mécanisme de souscription/publication. Il est léger, ouvert, simple, caractéristiques qui ont favorisées sa démocratiation dans la communication Machine to Machine (M2M) et l&#8217;internet des objets (IoT - Internet of Things).</simpara>
<simpara>Pour tout savoir sur MQTT, la série d&#8217;article <link xl:href="https://www.hivemq.com/mqtt-essentials/">MQTT Essentials</link> est à recommander.</simpara>
<simpara><?asciidoc-hr?></simpara>
</section>
<section xml:id="_configuration_du_plugin">
<title>Configuration du plugin</title>
<important>
<simpara>Pour ne pas installer le broker Mosquitto localement, c&#8217;est à dire sur la machine où tourne Jeedom, commencer par décocher la case <emphasis>Installer Mosquitto localement</emphasis>, sans oublier de sauvegarder la configuration.</simpara>
</important>
<simpara>Après installation du plugin, l&#8217;activer. Celui-ci prend quelques minutes pour installer les dépendances. Le suivi détaillé de la progression est possible via le log <literal><emphasis>jMQTT_dep</emphasis></literal> qui apparait au bout d&#8217;un moment en rafraichissant la page.</simpara>
<simpara>Par défaut le plugin est configuré pour s&#8217;inscrire au broker Mosquitto installé localement. Si cette configuration convient, cliquer sur Sauvegarder. Le status du démon passe à OK. Rafraichir la page pour faire apparaitre le fichier de log <literal><emphasis>jMQTT</emphasis></literal>.</simpara>
<tip>
<simpara>Configurer le niveau de log minimum à Info pour que le fichier de log apparaisse la première fois et avoir des informations intéressantes. Sauvegarder et relancer le démon pour rendre le changement actif.</simpara>
</tip>
<important>
<simpara>Il peut arriver que l&#8217;installation du plugin se bloque. Cela se produit si le serveur apache est relancé pendant l&#8217;installation (voir log <literal><emphasis>jMQTT_dep</emphasis></literal>). Pour se débloquer, se connecter à sa station Jeedom et supprimer le fichier <literal>/tmp/jeedom/jMQTT/progress_dep.txt</literal>.</simpara>
</important>
<simpara>Pour particulariser la configuration du plugin, les paramètres sont:</simpara>
<itemizedlist>
<listitem>
<simpara>Installer Mosquitto localement: cocher cette case pour que jMQTT se charge de l&#8217;installation locale du broker Mosquitto. Si votre broker est distant, décocher la case.</simpara>
</listitem>
<listitem>
<simpara>IP de Mosquitto: adresse IP du broker (par défaut localhost i.e. sur la machine hébergeant Jeedom).</simpara>
</listitem>
<listitem>
<simpara>Port de Mosquitto: port du broker (1883 par défaut).</simpara>
</listitem>
<listitem>
<simpara>Identifiant de connexion: identifiant avec lequel le plugin s&#8217;inscrit auprès du broker (jeedom par défaut). <emphasis role="strong">Attention</emphasis>: cet identifiant doit être unique par client et par broker. Sinon les clients portant le même identifiant vont se déconnecter l&#8217;un-l&#8217;autre à chaque connection.</simpara>
</listitem>
<listitem>
<simpara>Compte et mot de passe de connexion: compte et mot de passe de connexion au broker (laisser vide par défaut, notamment si jMQTT se charge de l&#8217;installation du broker, sauf bien-sûr si vous modifiez la configuration de ce dernier pour activer l&#8217;authentification).</simpara>
</listitem>
<listitem>
<simpara>Topic de souscription en mode inclusion automatique des équipements: topic de souscription automatique à partir duquel le plugin va découvrir les équipements de manière automatique, nous y revenons dans la partie équipements (défaut #, i.e. tous les topics).</simpara>
</listitem>
<listitem>
<simpara>Accès API: à activer pour utiliser l'<xref linkend="_api"/>.</simpara>
</listitem>
</itemizedlist>
<simpara>La sauvegarde de la configuration relance le démon et la souscription au broker MQTT avec les nouveaux paramètres.</simpara>
<tip>
<simpara>Il est conseillé d&#8217;activer la gestion automatique du démon. Ainsi, en cas de problème (e.g. perte de connexion au broker), Jeedom relancera le démon toutes les 5 minutes, aux minutes fixes 00, 05, 10, &#8230;&#8203;</simpara>
</tip>
<simpara><?asciidoc-hr?></simpara>
</section>
<section xml:id="_gestion_des_équipements">
<title>Gestion des équipements</title>
<simpara>La page de gestion des équipements est accessible via le menu <literal>Plugins &#8594; Protocole domotique &#8594; jMQTT</literal>.</simpara>
<simpara>Le panneau supérieur, intitulé <emphasis>Gestion</emphasis>, permet:</simpara>
<itemizedlist>
<listitem>
<simpara>La <xref linkend="_création_manuelle_d_un_équipement"/>;</simpara>
</listitem>
<listitem>
<simpara>L&#8217;activation du mode <xref linkend="_inclusion_automatique_des_équipements"/>;</simpara>
</listitem>
<listitem>
<simpara>L&#8217;accès à la <xref linkend="_configuration_du_plugin"/>;</simpara>
</listitem>
<listitem>
<simpara>L&#8217;accès à la page <xref linkend="_santé_du_plugin"/>.</simpara>
</listitem>
</itemizedlist>
<simpara>Le panneau inférieur, <emphasis>Mes jMQTT</emphasis> affiche les équipements présents. A noter que:</simpara>
<itemizedlist>
<listitem>
<simpara>Un équipement grisé est inactif;</simpara>
</listitem>
<listitem>
<simpara>Un équipement présenté avec un petit icône d&#8217;inclusion superposé, est un équipement dont l'<emphasis>Ajout automatique des commandes</emphasis> est activé (détails dans <xref linkend="_onglet_equipement"/>).</simpara>
</listitem>
</itemizedlist>
<section xml:id="_inclusion_automatique_des_équipements">
<title>Inclusion automatique des équipements</title>
<simpara>Le mode inclusion automatique permet la découverte et la création automatique des équipements. Il s&#8217;active en cliquant sur le bouton <emphasis>Mode inclusion</emphasis>. Il se désactive en recliquant sur le même bouton, ou automatiquement après 2 à 3 min.</simpara>
<simpara>Le plugin souscrit auprès du broker le topic configuré dans la page de <xref linkend="_configuration_du_plugin"/> (# par défaut, i.e. tous les topics).
A réception d&#8217;un message auquel aucun équipement n&#8217;a souscrit, le plugin crée automatiquement un équipement associé au topic de premier niveau.</simpara>
<simpara>Prenons comme exemple une payload MQTT publiant les messages suivants:</simpara>
<literallayout class="monospaced">boiler/brand "viesmann"
boiler/burner 0
boiler/temp 70.0</literallayout>
<simpara>A l&#8217;arrivée du premier message, le plugin crée automatiquement un équipement nommé <emphasis>boiler</emphasis>. Nous verrons dans la section <xref linkend="_onglet_commandes"/> que, par défaut, il créé aussi les informations associées à chaque message.</simpara>
<tip>
<simpara>Le mode inclusion automatique des équipements n&#8217;influe que sur la création de l&#8217;équipement, et pas sur la création des informations associées, qui dépend du paramètre <emphasis>Ajout automatique des commandes</emphasis> que nous verrons dans le chapitre suivant.</simpara>
</tip>
<note>
<simpara>Une fois les équipements découverts, il est conseillé de quitter le mode automatique pour éviter la création d&#8217;équipements non souhaités, notamment dans les situations suivantes : publication de messages (si jMQTT reste souscrit à tous les topics, il écoutera ses propres publications), essais avec le broker, tests de nouveaux équipements, &#8230;&#8203;</simpara>
</note>
</section>
<section xml:id="_paramètres_de_l_équipement">
<title>Paramètres de l&#8217;équipement</title>
<section xml:id="_onglet_equipement">
<title>Onglet Equipement</title>
<simpara>Dans le premier onglet d&#8217;un équipement jMQTT, nous trouvons les paramètres communs aux autres équipements Jeedom, ainsi que quatre paramètres spécifiques au plugin:</simpara>
<itemizedlist>
<listitem>
<simpara>Inscrit au Topic: topic de souscription auprès du broker;</simpara>
</listitem>
<listitem>
<simpara>Ajout automatique des commandes: si coché, les commandes de type information seront automatiquement créés par le plugin, et l&#8217;équipement apparaitra avec un petit icône d&#8217;inclusion superposé dans la page de <xref linkend="_gestion_des_équipements"/>. La case est cochée par défaut;</simpara>
</listitem>
<listitem>
<simpara>Qos: qualité de service souscrit;</simpara>
</listitem>
<listitem>
<simpara>Catégorie du topic: sélection d&#8217;une image spécifique à l&#8217;équipement.</simpara>
</listitem>
</itemizedlist>
<important>
<simpara>Une fois les commandes créés, il est conseillé de décocher la case <emphasis>Ajout automatique des commandes</emphasis> pour éviter la création d&#8217;informations non souhaitées.</simpara>
</important>
<simpara>Parmis le boutons en haut à gauche:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>Export</literal> permet d&#8217;obtenir un fichier JSON de toutes les informations de l&#8217;équipement. Il n&#8217;y a pas de fonctionalité import, le fichier peut surtout s&#8217;avérer utile pour investiguer sur problèmes;</simpara>
</listitem>
<listitem>
<simpara><literal>Dupliquer</literal> permet de <xref linkend="_dupliquer_un_équipement"/>.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_onglet_commandes">
<title>Onglet Commandes</title>
<section xml:id="_commandes_de_type_information">
<title>Commandes de type Information</title>
<formalpara>
<title>Payload simple</title>
<para>Les commandes de type information (informations dans la suite) sont créés automatiquement si la case <emphasis>Ajout automatique des commandes</emphasis> de l&#8217;Onglet Equipement est cochée. Reprenons l&#8217;exemple de la payload MQTT publiant les messages suivants:</para>
</formalpara>
<literallayout class="monospaced">boiler/brand "viesmann"
boiler/burner 0
boiler/temp 70.0
boiler/ext_temp 19.3
boiler/hw/setpoint 50
boiler/hw/temp 49.0</literallayout>
<simpara>Le plugin créé les informations suivantes:</simpara>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Nom</entry>
<entry align="left" valign="top">Sous-Type</entry>
<entry align="left" valign="top">Topic</entry>
<entry align="left" valign="top">Valeur</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>boiler/brand</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>boiler/brand</simpara></entry>
<entry align="left" valign="top"><simpara>viesmann</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>boiler/burner</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>boiler/burner</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>boiler/temp</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>boiler/temp</simpara></entry>
<entry align="left" valign="top"><simpara>70.0</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>boiler/ext_temp</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>boiler/ext_temp</simpara></entry>
<entry align="left" valign="top"><simpara>19.3</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>boiler/hw/setpoint</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>boiler/hw/setpoint</simpara></entry>
<entry align="left" valign="top"><simpara>50</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>boiler/hw/temp</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>boiler/hw/temp</simpara></entry>
<entry align="left" valign="top"><simpara>49.0</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<note>
<simpara>Jeedom, dans sa version actuelle, limite la longueur des noms de commande à 45 caractères. Dans le cas de commandes
de longueur supérieure, jMQTT remplace leurs noms par leur code de hashage md4 sur 32 caractères (e.g. 5182636929901af7fa5fd97da5e279e1).
L&#8217;utilisateur devra alors remplacer ces noms par le nommage de son choix.</simpara>
</note>
<formalpara>
<title>Payload JSON</title>
<para>Dans le cas d&#8217;une payload JSON, le plugin peut décoder le contenu et créer les informations associées, et ceci indépendamment de l&#8217;état de la case <emphasis>Ajout automatique des commandes</emphasis> de l&#8217;Onglet Equipement. Cette fonctionnalité doit être activée manuellement pour chaque commande information de ce type.</para>
</formalpara>
<simpara>Prenons l&#8217;exemple de la payload JSON suivante:</simpara>
<literallayout class="monospaced">esp/temperatures {"device": "ESP32", "sensorType": "Temperature", "values": [9.5, 18.2, 20.6]}</literallayout>
<simpara>Au premier message reçu, jMQTT créé automatiquement l&#8217;information suivante:</simpara>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="5">
<colspec colname="col_1" colwidth="20*"/>
<colspec colname="col_2" colwidth="20*"/>
<colspec colname="col_3" colwidth="20*"/>
<colspec colname="col_4" colwidth="20*"/>
<colspec colname="col_5" colwidth="20*"/>
<thead>
<row>
<entry align="left" valign="top">Nom</entry>
<entry align="left" valign="top">Sous-Type</entry>
<entry align="left" valign="top">Topic</entry>
<entry align="left" valign="top">Valeur</entry>
<entry align="left" valign="top">Paramètres</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>esp/temperatures</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>esp/temperatures</simpara></entry>
<entry align="left" valign="top"><simpara>{"device": "ESP32", "sensorType": "Temperature", "values": [9.5, 18.2, 20.6]}</simpara></entry>
<entry align="left" valign="top"><simpara><literal>[ ]</literal> parseJSON</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>En cochant l&#8217;option <emphasis>parseJSON</emphasis>, les informations complémentaires sont instantanément créés, ce qui donne:</simpara>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="5">
<colspec colname="col_1" colwidth="20*"/>
<colspec colname="col_2" colwidth="20*"/>
<colspec colname="col_3" colwidth="20*"/>
<colspec colname="col_4" colwidth="20*"/>
<colspec colname="col_5" colwidth="20*"/>
<thead>
<row>
<entry align="left" valign="top">Nom</entry>
<entry align="left" valign="top">Sous-Type</entry>
<entry align="left" valign="top">Topic</entry>
<entry align="left" valign="top">Valeur</entry>
<entry align="left" valign="top">Paramètres</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>esp/temperatures</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>esp/temperatures</simpara></entry>
<entry align="left" valign="top"><simpara>{"device": "ESP32", "sensorType": "Temperature", "values": [9.5, 18.2, 20.6]}</simpara></entry>
<entry align="left" valign="top"><simpara><literal>[X]</literal> parseJSON</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>temperatures{device}</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>esp/temperatures{device}</simpara></entry>
<entry align="left" valign="top"><simpara>"ESP32"</simpara></entry>
<entry align="left" valign="top"><simpara><literal>[ ]</literal> parseJSON</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>temperatures{sensorType}</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>esp/temperatures{sensorType}</simpara></entry>
<entry align="left" valign="top"><simpara>"Temperature"</simpara></entry>
<entry align="left" valign="top"><simpara><literal>[ ]</literal> parseJSON</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>temperatures{values}</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>esp/temperatures{values}</simpara></entry>
<entry align="left" valign="top"><simpara>[9.5, 18.2, 20.6]</simpara></entry>
<entry align="left" valign="top"><simpara><literal>[ ]</literal> parseJSON</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>Enfin, le vecteur des températures peut également être séparé en cochant la case  <emphasis>parseJSON</emphasis>, pour finalement obtenir:</simpara>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="5">
<colspec colname="col_1" colwidth="20*"/>
<colspec colname="col_2" colwidth="20*"/>
<colspec colname="col_3" colwidth="20*"/>
<colspec colname="col_4" colwidth="20*"/>
<colspec colname="col_5" colwidth="20*"/>
<thead>
<row>
<entry align="left" valign="top">Nom</entry>
<entry align="left" valign="top">Sous-Type</entry>
<entry align="left" valign="top">Topic</entry>
<entry align="left" valign="top">Valeur</entry>
<entry align="left" valign="top">Paramètres</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>esp/temperatures</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>esp/temperatures</simpara></entry>
<entry align="left" valign="top"><simpara>{"device": "ESP32", "sensorType": "Temperature", "values": [9.5, 18.2, 20.6]}</simpara></entry>
<entry align="left" valign="top"><simpara><literal>[X]</literal> parseJSON</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>temperatures{device}</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>esp/temperatures{device}</simpara></entry>
<entry align="left" valign="top"><simpara>"ESP32"</simpara></entry>
<entry align="left" valign="top"><simpara><literal>[ ]</literal> parseJSON</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>temperatures{sensorType}</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>esp/temperatures{sensorType}</simpara></entry>
<entry align="left" valign="top"><simpara>"Temperature"</simpara></entry>
<entry align="left" valign="top"><simpara><literal>[ ]</literal> parseJSON</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>temperatures{values}</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>esp/temperatures{values}</simpara></entry>
<entry align="left" valign="top"><simpara>[9.5, 18.2, 20.6]</simpara></entry>
<entry align="left" valign="top"><simpara><literal>[X]</literal> parseJSON</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>temperatures{values}{0}</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>esp/temperatures{values}{0}</simpara></entry>
<entry align="left" valign="top"><simpara>9.5</simpara></entry>
<entry align="left" valign="top"><simpara><literal>[ ]</literal> parseJSON</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>temperatures{values}{1}</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>esp/temperatures{values}{1}</simpara></entry>
<entry align="left" valign="top"><simpara>18.2</simpara></entry>
<entry align="left" valign="top"><simpara><literal>[ ]</literal> parseJSON</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>temperatures{values}{2}</simpara></entry>
<entry align="left" valign="top"><simpara>info</simpara></entry>
<entry align="left" valign="top"><simpara>esp/temperatures{values}{2}</simpara></entry>
<entry align="left" valign="top"><simpara>20.6</simpara></entry>
<entry align="left" valign="top"><simpara><literal>[ ]</literal> parseJSON</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<note>
<simpara>Le nom des commandes peut être modifié comme souhaité, jMQTT se base sur le champ Topic pour associer la bonne valeur.</simpara>
</note>
</section>
<section xml:id="_commandes_de_type_action">
<title>Commandes de type Action</title>
<simpara>Les commandes de type action permettent au plugin jMQTT de publier sur le broker MQTT. Pour cela, créer une commande via le bouton <emphasis>+ Ajouter une commande action</emphasis> et remplir les champs selon le besoin:</simpara>
<itemizedlist>
<listitem>
<simpara>Nom: champ libre;</simpara>
</listitem>
<listitem>
<simpara>Valeur par défaut de la commande: pour lier la valeur de la commande affichée sur le dashboard à une commande de type Information (exemple <link xl:href="https://www.jeedom.com/forum/viewtopic.php?f=96&amp;t=32675&amp;p=612364#p602740">ici</link>);</simpara>
</listitem>
<listitem>
<simpara>Sous-type: voir exemples ci-dessous;</simpara>
</listitem>
<listitem>
<simpara>Topic: topic de publication;</simpara>
</listitem>
<listitem>
<simpara>Valeur: définit la valeur publiée, i.e. la payload en langage MQTT, voir exemples ci-dessous;</simpara>
</listitem>
<listitem>
<simpara>Retain: si coché, la valeur sera persistante (conservée par le broker et publiée vers tout nouveau souscripteur);</simpara>
</listitem>
<listitem>
<simpara>Qos: niveau de qualité de service utilisé pour publier la commande (1 par défaut).</simpara>
</listitem>
</itemizedlist>
<formalpara>
<title>Sous-type Défaut</title>
<para>Les exemples du tableau suivant:</para>
</formalpara>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Nom</entry>
<entry align="left" valign="top">Sous-Type</entry>
<entry align="left" valign="top">Topic</entry>
<entry align="left" valign="top">Valeur</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>set_hw_setpoint</simpara></entry>
<entry align="left" valign="top"><simpara>action - Défaut</simpara></entry>
<entry align="left" valign="top"><simpara><literal>hw/setpoint/set</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>40</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>set_hw_setpoint</simpara></entry>
<entry align="left" valign="top"><simpara>action - Défaut</simpara></entry>
<entry align="left" valign="top"><simpara><literal>hw/set</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>{"name": "setpoint", "value": 40}</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>set_hw_setpoint</simpara></entry>
<entry align="left" valign="top"><simpara>action - Défaut</simpara></entry>
<entry align="left" valign="top"><simpara><literal>hw/set</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>{"name": "setpoint", "value": #[home][boiler][hw_setpoint]#}</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>Publieront respectivement:</simpara>
<literallayout class="monospaced">hw/setpoint/set 40
hw/set {"name": "setpoint", "value": 40}
hw/set {"name": "setpoint", "value": 45}</literallayout>
<simpara>En supposant que <literal>#[home][boiler][hw_setpoint]#</literal> a pour valeur 45.</simpara>
<formalpara>
<title>Sous-type Curseur</title>
<para>Les configurations suivantes publieront la valeur saisie via un widget de type curseur:</para>
</formalpara>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Nom</entry>
<entry align="left" valign="top">Sous-Type</entry>
<entry align="left" valign="top">Topic</entry>
<entry align="left" valign="top">Valeur</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>set_hw_setpoint</simpara></entry>
<entry align="left" valign="top"><simpara>action - Curseur</simpara></entry>
<entry align="left" valign="top"><simpara><literal>hw/setpoint/set</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>#slider#</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>set_hw_setpoint</simpara></entry>
<entry align="left" valign="top"><simpara>action - Curseur</simpara></entry>
<entry align="left" valign="top"><simpara><literal>hw/set</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>{"name": "setpoint", "value": #slider#}</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara>Soit respectivement, en supposant que la valeur du curseur est 50:</simpara>
<literallayout class="monospaced">hw/setpoint/set 50
hw/set {"name": "setpoint", "value": 50}</literallayout>
<note>
<simpara>Pour configurer les valeurs min/max d&#8217;un commande slider, éditer les paramètres avancées de la commande slider (la roue crantée à gauche du bouton <emphasis role="strong">Tester</emphasis>), aller dans l&#8217;onglet <emphasis role="strong">Affichage</emphasis> et ajouter <emphasis role="strong">minValue</emphasis> et <emphasis role="strong">maxValue</emphasis> dans la section <emphasis role="strong">Paramètres optionnels widget</emphasis> (cette configuration est apportée par le core de Jeedom, elle n&#8217;est pas spécifique à jMQTT).</simpara>
</note>
<formalpara>
<title>Sous-type Message</title>
<para>Pour un message dont le titre est <literal>ecs</literal> et le contenu est <literal>50</literal>, la configuration ci-après publiera:</para>
</formalpara>
<literallayout class="monospaced">boiler {"setpoint": "ecs", "value": 50}</literallayout>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Nom</entry>
<entry align="left" valign="top">Sous-Type</entry>
<entry align="left" valign="top">Topic</entry>
<entry align="left" valign="top">Valeur</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>set_ecs_setpoint</simpara></entry>
<entry align="left" valign="top"><simpara>action - Message</simpara></entry>
<entry align="left" valign="top"><simpara><literal>boiler</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>{"setpoint": "#title#", "value": #message#}</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<formalpara>
<title>Sous-type Couleur</title>
<para>La configuration suivante publiera le code couleur sélectionnée via un widget sélecteur de couleur, par exemple:</para>
</formalpara>
<literallayout class="monospaced">room/lamp/color #e63939</literallayout>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Nom</entry>
<entry align="left" valign="top">Sous-Type</entry>
<entry align="left" valign="top">Topic</entry>
<entry align="left" valign="top">Valeur</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>set_color</simpara></entry>
<entry align="left" valign="top"><simpara>action - Couleur</simpara></entry>
<entry align="left" valign="top"><simpara><literal>room/lamp/color</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>#color#</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</section>
<section xml:id="_vue_classic_vue_json">
<title>Vue Classic, vue JSON</title>
<simpara>Deux boutons en haut à droite de la page permettent de choisir entre 2 types du vue:</simpara>
<itemizedlist>
<listitem>
<simpara>La vue <emphasis role="strong">Classic</emphasis> montre les commandes dans l&#8217;ordre d&#8217;affichage sur la tuile du Dashboard. Elle permet de les réordonner par glissé/déposé;</simpara>
</listitem>
<listitem>
<simpara>La vue <emphasis role="strong">JSON</emphasis> affiche un arbre hiérarchique permettant de naviguer dans les commandes JSON, de les déplier/replier. Dans cette vue, l&#8217;ordonnancement des commandes via glissé/déposé est désactivée.</simpara>
</listitem>
</itemizedlist>
</section>
</section>
</section>
<section xml:id="_création_manuelle_d_un_équipement">
<title>Création manuelle d'un équipement</title>
<simpara>Il est aussi possible de créer manuellement des équipements jMQTT. Cliquer sur le bouton <emphasis role="strong">+</emphasis> et saisir le nom de l&#8217;équipement. Dans la page <xref linkend="_onglet_equipement"/>, le topic de souscription définit les informations qui seront souscrites par l&#8217;équipement.</simpara>
<simpara>Pour plus d&#8217;information sur les topics MQTT, nous conseillons la lecture de <link xl:href="https://www.hivemq.com/blog/mqtt-essentials-part-5-mqtt-topics-best-practices">MQTT Essentials Part 5: MQTT Topics &amp; Best Practices</link>.</simpara>
</section>
<section xml:id="_dupliquer_un_équipement">
<title>Dupliquer un équipement</title>
<simpara>Un équipement peut être dupliqué via le bouton <literal>Dupliquer</literal> situé en haut à gauche de la page de configuration de l&#8217;équipement.</simpara>
<simpara>Une boite de dialogue demande le nom du nouvel équipement. Sont dupliqués:</simpara>
<itemizedlist>
<listitem>
<simpara>Tous les paramètres de l&#8217;équipement y compris les paramètres de configuration avancés, sauf:</simpara>
<itemizedlist>
<listitem>
<simpara>Le nom bien sûr,</simpara>
</listitem>
<listitem>
<simpara>Le statut <emphasis>Activer</emphasis> : l&#8217;équipement est désactivé par défaut,</simpara>
</listitem>
<listitem>
<simpara>Le topic de souscription qui est laissé vide;</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Les commandes de type action y compris leurs paramètres de configuration accessibles via la roue crantée.</simpara>
</listitem>
</itemizedlist>
<important>
<simpara>Le topic des commandes dupliquées de type action doit être modifié manuellement.</simpara>
</important>
<note>
<simpara>Les commandes de type info ne sont pas dupliquées. Elles seront découvertes automatiquement après définition du topic de souscription et activation de l&#8217;équipement, si la case <emphasis>Ajout automatique des commandes</emphasis> est cochée.</simpara>
</note>
</section>
<section xml:id="_santé_du_plugin">
<title>Santé du plugin</title>
<simpara>Ce chapitre est à écrire.</simpara>
<important>
<simpara>La colonne <emphasis>Status</emphasis> n&#8217;est pas significative, elle indique toujours OK. Sera corrigé dans une version ultérieure du plugin.</simpara>
</important>
</section>
<section xml:id="_l_équipement_jeedom">
<title>L&#8217;équipement jeedom</title>
<simpara>Le plugin jMQTT publie en mode persistant son état de connexion sous le topic <literal><emphasis>Identifiant de connexion</emphasis>/status</literal>, <literal>jeedom/status</literal> par défaut, puisque l&#8217;identifiant de connexion vaut jeedom par défaut et se configure via la page de <xref linkend="_configuration_du_plugin"/>.</simpara>
<simpara>Les valeurs possibles sont <literal>offline</literal> et <literal>online</literal>.</simpara>
<simpara>Lorsque Jeedom est en mode <xref linkend="_inclusion_automatique_des_équipements"/>, il créé un équipement, dont le nom est <literal><emphasis>Identifiant de connexion</emphasis></literal> qui a ce statut en information.</simpara>
<simpara>Cet état permet à un équipement externe à Jeedom de connaitre son statut de connexion. Il peut aussi servir en interne Jeedom pour monitorer la connexion au broker via un scénario.</simpara>
<simpara><?asciidoc-hr?></simpara>
</section>
</section>
<section xml:id="_api">
<title>API</title>
<simpara>Le plugin permet d&#8217;accéder à toutes les méthodes de l&#8217;<link xl:href="http://jeedom.github.io/core/fr_FR/jsonrpc_api">API JSON RPC</link> au travers du protocole MQTT.</simpara>
<important>
<simpara>Pour activer l&#8217;API:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Activer l&#8217;accès à l&#8217;API jMQTT dans la page de <xref linkend="_configuration_du_plugin"/>;</simpara>
</listitem>
<listitem>
<simpara>Activer l'<emphasis role="strong">API JSON RPC</emphasis> dans la configuration Jeedom.</simpara>
</listitem>
</orderedlist>
</important>
<simpara>Les payloads requêtes doivent être adressées au topic <literal><emphasis>Identifiant de connexion</emphasis>/api</literal>, <literal>jeedom/api</literal> par défaut, l&#8217;identifiant de connexion étant jeedom par défaut et se configurant via la page de <xref linkend="_configuration_du_plugin"/>.</simpara>
<simpara>Leur format JSON est:</simpara>
<literallayout class="monospaced">{"method": "Méthode de la requête", "id": "Id. de la requête", "params": { Paramètres additionels }, "topic": "Topic de retour"}</literallayout>
<simpara>Où:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>Méthode de la requête</literal> : nom de la méthode invoquée, voir <link xl:href="http://jeedom.github.io/core/fr_FR/jsonrpc_api">API JSON RPC</link>;</simpara>
</listitem>
<listitem>
<simpara><literal>Id. de la requête</literal> (optionnel) : identifiant qui sera retourné dans la réponse, doit être une chaine. Si absent, l&#8217;id de retour sera null;</simpara>
</listitem>
<listitem>
<simpara><literal>Paramètres additionels</literal> (optionnel) : paramètres relatifs à la méthode de la requête, voir <link xl:href="http://jeedom.github.io/core/fr_FR/jsonrpc_api">API JSON RPC</link>;</simpara>
</listitem>
<listitem>
<simpara><literal>Topic de retour</literal> (optionnel) : topic sous lequel le plugin jMQTT publie la réponse à la requête. Si absent, la réponse n&#8217;est pas publiée.</simpara>
</listitem>
</itemizedlist>
<formalpara>
<title>Exemple:</title>
<para>Le tableau suivant fournit quelques exemples:</para>
</formalpara>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Requête</entry>
<entry align="left" valign="top">Réponse</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>{"method":"ping","topic":"retour"}</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>{"jsonrpc":"2.0","id":null,"result":"pong"}</literal> sur le topic <literal>retour</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Teste la communication avec Jeedom</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>{"method":"ping","id":"3","topic":"retour"}</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>{"jsonrpc":"2.0","id":"3","result":"pong"}</literal> sur le topic <literal>retour</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Teste la communication avec Jeedom</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>{"method":"cmd::execCmd","topic":"emetteur/retour", "id":"a","params":{"id":"798","options":{"slider":"40"}}}</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>{"jsonrpc":"2.0", "id":"a", "result":{"value":"40","collectDate":""}}</literal> sur le topic <literal>emetteur/retour</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Exécute la commande 798: positionne le curseur à 40</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<simpara><?asciidoc-hr?></simpara>
</section>
<section xml:id="_faq">
<title>FAQ</title>
<section xml:id="_quelles_données_fournir_pour_investigation_en_cas_de_problèmes">
<title>Quelles données fournir pour investigation en cas de problèmes ?</title>
<simpara>En cas de problèmes à l&#8217;installation, fournir les fichiers de log jMQTT (niveau Debug) et jMQTT_dep.</simpara>
<simpara>En cas de problèmes à l&#8217;utilisation, fournir:</simpara>
<itemizedlist>
<listitem>
<simpara>Le fichier de log <literal>jMQTT</literal>, niveau Debug;</simpara>
</listitem>
<listitem>
<simpara>Le résultat de la commande suivante:</simpara>
</listitem>
</itemizedlist>
<literallayout class="monospaced">mosquitto_sub -h localhost -t "#" -v| xargs -d$'\n' -L1 bash -c 'date "+%Y-%m-%d %T.%3N $0"' | tee /tmp/mosquitto_sub.log</literallayout>
<simpara>En remplaçant, si besoin, <literal>localhost</literal> par le nom ou l&#8217;ip de la machine hébergeant le broker MQTT.</simpara>
<simpara>Si le broker requiert une authentification, il faudra ajouter <literal>-u username</literal> et <literal>-p password</literal> avant le <literal>-v</literal>.</simpara>
</section>
<section xml:id="_le_démon_se_déconnecte_avec_le_message_erreur_sur_jmqtt_daemon_the_connection_was_lost">
<title>Le démon se déconnecte avec le message "Erreur sur jMQTT::daemon() : The connection was lost."</title>
<simpara>Vérifier qu&#8217;il n&#8217;y a pas 2 clients ayant le même identifiant, voir <emphasis>Identifiant de connexion</emphasis> dans le chapitre <xref linkend="_configuration_du_plugin"/>.</simpara>
<simpara><?asciidoc-hr?></simpara>
</section>
</section>
<section xml:id="_problèmes_connus">
<title>Problèmes connus</title>
<simpara>Les problèmes connus en cours d&#8217;investigation sont sur GitHub: <link xl:href="https://github.com/domotruc/jMQTT/issues">Issues jMQTT</link>.</simpara>
<simpara>Il peut arriver que l&#8217;installation des dépendances se bloque, se référer au chapitre <xref linkend="_configuration_du_plugin"/>.</simpara>
<simpara><?asciidoc-hr?></simpara>
</section>
<section xml:id="_exemples_d_utilisation">
<title>Exemples d&#8217;utilisation</title>
<section xml:id="_commander_un_virtuel_via_un_message_mqtt">
<title>Commander un Virtuel via un message MQTT</title>
<simpara>Supposons un équipement virtuel, appellé <emphasis>Saison Virtuel</emphasis>, dont une commande action de sous-type Liste permette
de définir la saison (été, hiver).
L&#8217;objectif est de pouvoir définir cette saison via un message MQTT envoyé par une application externe.</simpara>
<simpara>Supposons donc également un équipement jMQTT, appelé <emphasis>Saison_jMQTT</emphasis>, souscrivant au topic <literal>saison/#</literal>, dont une
commande info est <literal>saison/set</literal>.</simpara>
<simpara>Nous souhaitons donc que lorque une application publie le message <literal>saison/set hiver</literal> sur le broker, la commande info saison
du virtuel soit mise à jour avec <emphasis>hiver</emphasis>.</simpara>
<simpara>Pour ce faire, il faut créer une deuxième commande action côté virtuel (commande <emphasis>set_saison</emphasis> ci-dessous) qui mette à jour
l&#8217;information saison du virtuel à partir de celle de l&#8217;équipement jMQTT. Le virtuel est donc configuré comme ceci:</simpara>
<informalfigure>
<mediaobject>
<imageobject>
<imagedata fileref="../images/saison_virtuel.png"/>
</imageobject>
<textobject><phrase>saison virtuel</phrase></textobject>
</mediaobject>
</informalfigure>
<simpara>Côté équipement jMQTT, nous avons la configuration simple suivante:</simpara>
<informalfigure>
<mediaobject>
<imageobject>
<imagedata fileref="../images/saison_jmqtt.png"/>
</imageobject>
<textobject><phrase>saison jmqtt</phrase></textobject>
</mediaobject>
</informalfigure>
<simpara>Ensuite, il y a deux solutions pour lier les commandes:</simpara>
<itemizedlist>
<listitem>
<simpara>Créer un scénario avec la commande info <literal>[Saison jMQTT][set]</literal> comme déclencheur, qui executerait la commande action
<literal>[Saison Virtuel][set_saison]</literal>; ou</simpara>
</listitem>
<listitem>
<simpara>Configurer une <emphasis>action sur valeur</emphasis> en cliquant sur la roue crantée à droite de la commande info <literal>[Saison jMQTT][set]</literal>,
onglet <emphasis>Configuration</emphasis>:</simpara>
</listitem>
</itemizedlist>
<informalfigure>
<mediaobject>
<imageobject>
<imagedata fileref="../images/saison_action_sur_valeur.png"/>
</imageobject>
<textobject><phrase>saison action sur valeur</phrase></textobject>
</mediaobject>
</informalfigure>
<simpara>Attention, quelque soit la solution, il est important de configurer la <emphasis>Gestion de la répétition des valeurs</emphasis> de la commande
info <literal>[Saison jMQTT][set]</literal> à <emphasis>Toujours répéter</emphasis> pour que toutes les valeurs remontent au virtuel. Pour celà, toujours en cliquant
 sur la roue crantée à droite de cette dernière, onglet <emphasis>Configuration</emphasis>:</simpara>
<informalfigure>
<mediaobject>
<imageobject>
<imagedata fileref="../images/saison_repetition.png"/>
</imageobject>
<textobject><phrase>saison repetition</phrase></textobject>
</mediaobject>
</informalfigure>
<simpara><?asciidoc-hr?></simpara>
</section>
</section>
<section xml:id="_change_log">
<title>Change log</title>
<section xml:id="_2019_04_10">
<title>2019-04-10</title>
<itemizedlist>
<listitem>
<simpara>Correction de <link xl:href="https://github.com/domotruc/jMQTT/issues/70">#70</link>: problème de reconnaissance des topics avec accents</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2019_04_06">
<title>2019-04-06</title>
<itemizedlist>
<listitem>
<simpara>Transition vers style V4</simpara>
</listitem>
</itemizedlist>
<important>
<simpara>Core Jeedom 3.3.19 ou supérieur requis à partir de la version 2019-04-06.</simpara>
</important>
</section>
<section xml:id="_2019_03_06">
<title>2019-03-06</title>
<itemizedlist>
<listitem>
<simpara>Passage en stable des évolutions des 2 versions betas précédentes</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2019_03_05_beta">
<title>2019-03-05 (beta)</title>
<itemizedlist>
<listitem>
<simpara>Amélioration documentation (commandes slider)</simpara>
</listitem>
<listitem>
<simpara>Rend les boutons avancer/reculer du navigateur fonctionnels</simpara>
</listitem>
<listitem>
<simpara>Correction mineure pour compatibilité avec core 3.3</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2019_03_01_beta">
<title>2019-03-01 (beta)</title>
<itemizedlist>
<listitem>
<simpara>Correction de <link xl:href="https://github.com/domotruc/jMQTT/issues/69">#69</link>: message de confirmation de fermeture de page inopportun</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2019_02_20">
<title>2019-02-20</title>
<itemizedlist>
<listitem>
<simpara>Amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/68">#68</link>: amélioration robustesse aux deconnections intempestives</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_02_16">
<title>2018-02-16</title>
<itemizedlist>
<listitem>
<simpara>Passage en stable des évolutions des 4 versions betas précédentes</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2019_02_09_beta">
<title>2019-02-09 (beta)</title>
<itemizedlist>
<listitem>
<simpara>Amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/67">#67</link>: visualisation de la mise à jour des valeurs dans le panneau commande</simpara>
</listitem>
<listitem>
<simpara>Amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/66">#66</link>: amélioration perfo en ne sauvant pas les commandes sur maj valeur</simpara>
</listitem>
<listitem>
<simpara>Amélioration de la documentation (<link xl:href="https://github.com/domotruc/jMQTT/issues/65">#65</link>)</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_12_27_beta">
<title>2018-12-27 (beta)</title>
<itemizedlist>
<listitem>
<simpara>Correction de <link xl:href="https://github.com/domotruc/jMQTT/issues/64">#64</link>: problème affichage barre de bouton du panneau commandes</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_12_08_beta">
<title>2018-12-08 (beta)</title>
<itemizedlist>
<listitem>
<simpara>Correction de <link xl:href="https://github.com/domotruc/jMQTT/issues/62">#62</link>: Erreur sur jMQTT::daemon() : Using $this when not in object context</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_11_11_beta">
<title>2018-11-11 (beta)</title>
<itemizedlist>
<listitem>
<simpara>Amélioration code pour besoin de tests</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_11_04">
<title>2018-11-04</title>
<itemizedlist>
<listitem>
<simpara>Correction de <link xl:href="https://github.com/domotruc/jMQTT/issues/58">#58</link>: MySql duplicate entry error sur topic dépassant
45 caractères. Voir documentation, chapitre <xref linkend="_commandes_de_type_information"/>.</simpara>
</listitem>
<listitem>
<simpara>Amélioration initialisation équipement sur création manuelle de façon à afficher les paramètres pas défaut comme Qos</simpara>
</listitem>
<listitem>
<simpara>Ajout du chapitre exemple dans la documentation</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_10_24">
<title>2018-10-24</title>
<itemizedlist>
<listitem>
<simpara>Amélioration script installation des dépendances pour corriger <link xl:href="https://github.com/domotruc/jMQTT/issues/59">#59</link></simpara>
</listitem>
<listitem>
<simpara>Correction typo dans message affiché à l&#8217;utilisateur (équipment &#8658; équipement), merci Gwladys</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_09_16">
<title>2018-09-16</title>
<itemizedlist>
<listitem>
<simpara>Correction de <link xl:href="https://github.com/domotruc/jMQTT/issues/57">#57</link>: perte de connexion du démon sur rafale de message (merci jmc)</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_06_12">
<title>2018-06-12</title>
<itemizedlist>
<listitem>
<simpara>Intégration des évolutions des 3 versions betas précédentes</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_06_11_beta">
<title>2018-06-11 (beta)</title>
<itemizedlist>
<listitem>
<simpara>Correction bugs mineurs relatif à <link xl:href="https://github.com/domotruc/jMQTT/issues/53">#53</link>:</simpara>
<itemizedlist>
<listitem>
<simpara>Lorsque le topic de retour n&#8217;est pas défini &#8658; affiche une erreur;</simpara>
</listitem>
<listitem>
<simpara>Lorsque l&#8217;encodage JSON de la requête est incorrect &#8658; affiche un message d&#8217;erreur plus clair.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_06_10_beta">
<title>2018-06-10 (beta)</title>
<itemizedlist>
<listitem>
<simpara>Complément à l&#8217;amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/53">#53</link>:</simpara>
<itemizedlist>
<listitem>
<simpara>Ajoute un paramètre pour activer/désactiver l&#8217;API dans la configuration plugin;</simpara>
</listitem>
<listitem>
<simpara>topic jeedom/jeeAPI changé en jeedom/api;</simpara>
</listitem>
<listitem>
<simpara>Mise à jour doc.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_06_07_beta">
<title>2018-06-07 (beta)</title>
<itemizedlist>
<listitem>
<simpara>Amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/53">#53</link>: api MQTT</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_06_03">
<title>2018-06-03</title>
<itemizedlist>
<listitem>
<simpara>Intégration des évolutions des 3 versions betas précédentes</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_06_03_beta">
<title>2018-06-03 (beta)</title>
<itemizedlist>
<listitem>
<simpara>Amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/55">#55</link>: ajout d&#8217;une vue de visualisation hiérarchique JSON dans le panneau des commandes</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_05_26_beta">
<title>2018-05-26 (beta)</title>
<itemizedlist>
<listitem>
<simpara>Amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/45">#45</link>: décodage immédiat des payloads JSON sur activation de parseJSON</simpara>
</listitem>
<listitem>
<simpara>Amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/52">#52</link>: activer l&#8217;export d&#8217;un équipement dans un fichier json</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_05_24_beta">
<title>2018-05-24 (beta)</title>
<itemizedlist>
<listitem>
<simpara>Amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/51">#51</link>: ajoute des messages d&#8217;alerte informant sur la création de commandes</simpara>
</listitem>
<listitem>
<simpara>Amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/50">#50</link>: ajoute un bouton d&#8217;actualisation dans la page équipement</simpara>
</listitem>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/49">#49</link>: pas de demande de confirmation de sortie de page sur modifications de certains paramètres</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_05_11">
<title>2018-05-11</title>
<itemizedlist>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/47">#47</link>: erreur "call to undefined function mb_check_encoding"</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_05_10">
<title>2018-05-10</title>
<itemizedlist>
<listitem>
<simpara>Intégration des évolutions des 2 versions beta précédentes</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_05_10_beta">
<title>2018-05-10 (beta)</title>
<itemizedlist>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/46">#46</link>: mauvaise payload avec caractères non ASCII corrompt la commande information associée</simpara>
</listitem>
<listitem>
<simpara>Amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/44">#44</link>: amélioration de l&#8217;affichage dans le panneau de commandes</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_05_08_beta">
<title>2018-05-08 (beta)</title>
<itemizedlist>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/42">#42</link>: log erroné sur création d&#8217;une commande info</simpara>
</listitem>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/41">#41</link>: retour de jMQTT dans la catégorie protocole domotique (au lieu de passerelle domotique).</simpara>
</listitem>
<listitem>
<simpara>Amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/43">#43</link>: logguer qu&#8217;un équipement ou une commande est supprimé.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_04_29">
<title>2018-04-29</title>
<itemizedlist>
<listitem>
<simpara>Amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/40">#40</link>: ajout du champ "valeur de la commande par defaut" (voir <link xl:href="https://www.jeedom.com/forum/viewtopic.php?f=96&amp;t=32675&amp;p=612364#p602740">post de vincnet68 sur le forum</link>).</simpara>
</listitem>
<listitem>
<simpara>MAJ icone et fichier info.json suite évolution processus de publication sur le market (mail <link xl:href="mailto:partenaire@jeedom.com">partenaire@jeedom.com</link> du 16/04/2018).</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_02_15">
<title>2018-02-15</title>
<itemizedlist>
<listitem>
<simpara>Amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/36">#36</link>: le mode inclusion automatique d&#8217;équipements s&#8217;active maintenant via un bouton d&#8217;inclusion depuis la page du plugin et se désactive automatiquement après 2 à 3 min.</simpara>
</listitem>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/37">#37</link>: la bordure mettant en évidence un équipement dont l&#8217;ajout automatique de commandes est actif, est correctement affichée quelque soit le thème.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_02_06">
<title>2018-02-06</title>
<itemizedlist>
<listitem>
<simpara>Amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/26">#26</link>: ajout d&#8217;une case à cocher dans l&#8217;équipement permettant de désactiver la création automatique des commandes de type information.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_02_05">
<title>2018-02-05</title>
<itemizedlist>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/30">#30</link>: les commandes action n&#8217;étaient pas envoyées immédiatement depuis des scénarios.</simpara>
</listitem>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/25">#25</link>: les commandes avec Qos=2 n&#8217;étaient pas envoyées.</simpara>
</listitem>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/28">#28</link>: rend possible la définition de commandes action JSON (voir exemples dans la documentation: <xref linkend="_commandes_de_type_action"/>).</simpara>
</listitem>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/31">#31</link>: message de log erroné sur accusé de réception de souscription.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_01_26">
<title>2018-01-26</title>
<itemizedlist>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/23">#23</link>: sur une rafale de commande, seule la dernière était envoyée.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_01_24">
<title>2018-01-24</title>
<itemizedlist>
<listitem>
<simpara>Amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/19">#19</link>: ajoute une option pour ne pas installer Mosquitto localement.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_01_15">
<title>2018-01-15</title>
<itemizedlist>
<listitem>
<simpara>Amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/10">#10</link>: duplication d&#8217;équipement (voir la doc).</simpara>
</listitem>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/15">#15</link>: les topics commençant par / n&#8217;étaient pas souscrits après désactivation du mode manuel</simpara>
</listitem>
</itemizedlist>
<important>
<simpara>Si vous avez des topics commençant par / créés avant cette version, il faut ajouter le / en début de topic souscrit dans les équipements concernés. Les commandes de types info vont être recréer par le plugin, il faudra supprimer les anciennes (celles dont le topic ne commencent pas par /). En cas de doutes, de questions, n&#8217;hésiter pas à poster sur le forum.</simpara>
</important>
<itemizedlist>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/13">#13</link>: commande null systématiquement envoyée sur création d&#8217;une commande action.</simpara>
</listitem>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/14">#14</link>: le champ de sélection value, sous le nom d&#8217;une commande de type action, est supprimé car il n&#8217;avait pas d&#8217;effet.</simpara>
</listitem>
<listitem>
<simpara>Amélioration <link xl:href="https://github.com/domotruc/jMQTT/issues/17">#17</link>: autorise les équipements avec topic vide.</simpara>
</listitem>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/18">#18</link>: arrête de créer une commande info relative à une commande action.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_01_08">
<title>2018-01-08</title>
<itemizedlist>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/9">#9</link>: l&#8217;installation se bloque à 80% au redémarrage du serveur apache.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_01_06">
<title>2018-01-06</title>
<itemizedlist>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/7">#7</link>: erreur "Le nom de l&#8217;équipement ne peut pas être vide" et arrêt du démon sur réception d&#8217;un topic commençant par /.</simpara>
</listitem>
<listitem>
<simpara>Amélioration de l&#8217;installation: ajout du statut de progression, lisibilité fichier de log</simpara>
</listitem>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/1">#1</link>: dernière valeur maintenue retain au niveau du broker sur suppression du mode retain d&#8217;une commande.</simpara>
</listitem>
<listitem>
<simpara>Correction <link xl:href="https://github.com/domotruc/jMQTT/issues/6">#6</link>: case inversion cochée par défaut pour information binaire.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_01_04">
<title>2018-01-04</title>
<itemizedlist>
<listitem>
<simpara>MAJ du README côté GitHub</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_01_03">
<title>2018-01-03</title>
<itemizedlist>
<listitem>
<simpara>MAJ de la documentation</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2018_01_01">
<title>2018-01-01</title>
<itemizedlist>
<listitem>
<simpara>Supprime les tentatives de reconnexion toutes les secondes sur problème de connexion au broker: rend maintenant la main au core Jeedom qui relancera le démon (et donc la reconnexion) toutes les 5min.</simpara>
</listitem>
<listitem>
<simpara>Correction bug sur authentification auprès du broker (merci Nicolas)</simpara>
</listitem>
<listitem>
<simpara>Message d&#8217;erreur sur définition d&#8217;un topic vide</simpara>
</listitem>
<listitem>
<simpara>MAJ fichier internationalisation</simpara>
</listitem>
<listitem>
<simpara>Changement de la couleur de l&#8217;icône et des images du plugin (jaune au lieu de bleu)</simpara>
</listitem>
<listitem>
<simpara>MAJ liens de la doc</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_2017_12_26">
<title>2017-12-26</title>
<itemizedlist>
<listitem>
<simpara>Version initiale</simpara>
</listitem>
</itemizedlist>
</section>
</section>
</article>