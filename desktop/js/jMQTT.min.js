var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var d=0;return function(){return d<a.length?{done:!1,value:a[d++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var d="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return d?d.call(a):$jscomp.arrayIterator(a)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,c){a!=Array.prototype&&a!=Object.prototype&&(a[d]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,d,c,b){if(d){c=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var e=a[b];e in c||(c[e]={});c=c[e]}a=a[a.length-1];b=c[a];d=d(b);d!=b&&null!=d&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var d=b.length;c=c||0;for(0>c&&(c=Math.max(c+d,0));c<d;c++){var f=b[c];if(f===a||Object.is(f,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,d,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(d instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");
$jscomp.findInternal=function(a,d,c){a instanceof String&&(a=String(a));for(var b=a.length,e=0;e<b;e++){var f=a[e];if(d.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var b="";a;)if(a&1&&(b+=c),a>>>=1)c+=c;return b}},"es6","es3");var refreshTimeout,N_CMD;
function initPluginUrl(a){a=void 0===a?["id","saveSuccessFull","removeSuccessFull"]:a;var d=getUrlVars(),c="",b;for(b in d)0>$.inArray(b,a)&&(0<c.length&&(c+="&"),c+=b+"="+d[b].replace("#",""));return"index.php?"+c}
function refreshEqLogicPage(){function a(){void 0!=$(".li_eqLogic.active").attr("data-eqLogic_id")?$(".li_eqLogic[data-eqLogic_id="+$(".li_eqLogic.active").attr("data-eqLogic_id")+"]").click():$(".eqLogicAction[data-action=returnToThumbnailDisplay]").click()}modifyWithoutSave?bootbox.confirm("{{La page a \u00e9t\u00e9 modifi\u00e9e. Etes-vous s\u00fbr de vouloir la recharger sans sauver ?}}",function(d){d&&a()}):a()}$(document).ready(function(){window.location.href.includes("#commandtab")&&$("#menu-bar").show()});
$("#bt_addMQTTInfo").on("click",function(a){addCmdToTable({type:"info"});modifyWithoutSave=!0});$("#bt_addMQTTAction").on("click",function(a){addCmdToTable({type:"action"});modifyWithoutSave=!0});$("#bt_healthMQTT").on("click",function(){$("#md_modal").dialog({title:"{{Sant\u00e9 jMQTT}}"});$("#md_modal").load("index.php?v=d&plugin=jMQTT&modal=health").dialog("open")});
$("#table_cmd").delegate(".listEquipementAction","click",function(){var a=$(this);jeedom.cmd.getSelectModal({cmd:{type:"action"}},function(d){a.closest("tr").find(".cmdAttr[data-l1key=configuration][data-l2key="+a.attr("data-input")+"]").value(d.human)})});
$("#table_cmd").delegate(".listEquipementInfo","click",function(){var a=$(this);jeedom.cmd.getSelectModal({cmd:{type:"info"}},function(d){a.closest("tr").find(".cmdAttr[data-l1key=configuration][data-l2key="+a.data("input")+"]").atCaret("insert",d.human);modifyWithoutSave=!0})});$(".eqLogicAction[data-action=refreshPage]").on("click",refreshEqLogicPage);$("#bt_classic").on("click",function(){refreshEqLogicPage();$("#bt_classic").removeClass("btn-default").addClass("btn-primary");$("#bt_json").removeClass("btn-primary").addClass("btn-default")});
$("#bt_json").on("click",function(){refreshEqLogicPage();$("#bt_json").removeClass("btn-default").addClass("btn-primary");$("#bt_classic").removeClass("btn-primary").addClass("btn-default")});$('a[href="#eqlogictab"]').on("click",function(){$("#menu-bar").hide()});$('a[href="#commandtab"]').on("click",function(){$("#menu-bar").show()});
1==getUrlVars("saveSuccessFull")&&($("#div_alert").showAlert({message:"{{Sauvegarde effectu\u00e9e avec succ\u00e8s}}",level:"success"}),history.replaceState(history.state,"",initPluginUrl(["saveSuccessFull"])));1==getUrlVars("removeSuccessFull")&&($("#div_alert").showAlert({message:"{{Suppression effectu\u00e9e avec succ\u00e8s}}",level:"success"}),history.replaceState(history.state,"",initPluginUrl(["removeSuccessFull"])));
$("#table_cmd").sortable({axis:"y",cursor:"move",items:".cmd",placeholder:"ui-state-highlight",tolerance:"intersect",forcePlaceholderSize:!0});
function printEqLogic(a){function d(a){a=parseInt(a).toString(36);3>a.length&&(a="0".repeat(3-a.length)+a);return a}function c(b){if(void 0!=b.sOrder)return b.sOrder;var e="";void 0!=b.configuration.jParent&&0<=b.configuration.jParent&&(e=a.cmd.filter(function(a){return a.id==b.configuration.jParent}),e=c(e[0]));sOrder=void 0==b.configuration.jOrder||0>b.configuration.jOrder?d(b.order):d(b.configuration.jOrder);return e+sOrder}if($("#bt_json.active").length){N_CMD=1;for(var b=$jscomp.makeIterator(a.cmd),
e=b.next();!e.done;e=b.next())e=e.value,e.sOrder=c(e);a.cmd.sort(function(a,b){return a.sOrder<b.sOrder?-1:a.sOrder>b.sOrder?1:0});$("#table_cmd").sortable("disable");$("#table_cmd th:first").width("120px")}else $("#table_cmd").sortable("enable"),$("#table_cmd th:first").width("50px")}
function addCmdToTable(a){isset(a)||(a={configuration:{}});isset(a.configuration)||(a.configuration={});if("info"==init(a.type)){var d=function(b){$(".cmd[data-cmd_id="+a.id+"] .form-control[data-key=value]").value(b)},c="1"==init(a.configuration.virtualAction)?"disabled":"",b='<tr class="cmd';$("#bt_json.active").length&&(b+=" treegrid-"+N_CMD,0<=a.configuration.jParent&&(b+=" treegrid-parent-"+$(".cmd[data-cmd_id="+a.configuration.jParent+"]").attr("class").split("treegrid-")[1]));b+='" data-cmd_id="'+
init(a.id)+'">';b+='<td><span class="cmdAttr" data-l1key="id"></span>';b=$("#bt_json.active").length?b+'<span style="display:none;" class="cmdAttr" data-l1key="order"></span></td>':b+"</td>";b+='<td><textarea class="cmdAttr form-control input-sm" data-l1key="name" style="height:65px;" placeholder="{{Nom de l\'info}}" /></td>';b+="<td>";b+='<input class="cmdAttr form-control type input-sm" data-l1key="type" value="info" disabled style="margin-bottom:5px;width:120px;" />';b+='<span class="cmdAttr subType" subType="'+
init(a.subType)+'"></span>';b+="</td><td>";b+='<textarea class="cmdAttr form-control input-sm" data-l1key="configuration" data-l2key="topic" style="height:65px;" '+c+' placeholder="{{Topic}}" readonly=true />';b+="</td><td>";b+='<textarea class="form-control input-sm" data-key="value" style="height:65px;" '+c+' placeholder="{{Valeur}}" readonly=true />';b+="</td><td>";b+='<input class="cmdAttr form-control input-sm" data-l1key="unite" placeholder="{{Unit\u00e9}}"></td><td>';b+='<span><label class="checkbox-inline"><input type="checkbox" class="cmdAttr checkbox-inline" data-l1key="isHistorized" checked/>{{Historiser}}</label></span> ';
b+='<span><label class="checkbox-inline"><input type="checkbox" class="cmdAttr checkbox-inline" data-l1key="isVisible" checked/>{{Afficher}}</label></span> ';b+='<span><label class="checkbox-inline"><input type="checkbox" class="cmdAttr checkbox-inline" data-l1key="display" data-l2key="invertBinary"/>{{Inverser}}</label></span> ';b+='<span><label class="checkbox-inline"><input type="checkbox" class="cmdAttr checkbox-inline" data-l1key="configuration" data-l2key="parseJson"/>{{parseJson}}</label></span> ';
b+="</td>";b+="<td>";is_numeric(a.id)&&(b+='<a class="btn btn-default btn-xs cmdAction" data-action="configure"><i class="fa fa-cogs"></i></a> ',b+='<a class="btn btn-default btn-xs cmdAction" data-action="test"><i class="fa fa-rss"></i> {{Tester}}</a>');b+='<i class="fa fa-minus-circle pull-right cmdAction cursor" data-action="remove"></i>';b+='<input style="width:82%;margin-bottom:2px;" class="tooltips cmdAttr form-control input-sm" data-l1key="cache" data-l2key="lifetime" placeholder="{{Lifetime cache}}" title="{{Lifetime cache}}">';
b+='<input class="tooltips cmdAttr form-control input-sm" data-l1key="configuration" data-l2key="minValue" placeholder="{{Min}}" title="{{Min}}" style="width:40%;display:inline-block;"> ';b+='<input class="tooltips cmdAttr form-control input-sm" data-l1key="configuration" data-l2key="maxValue" placeholder="{{Max}}" title="{{Max}}" style="width:40%;display:inline-block;">';b+="</td></tr>";$("#table_cmd tbody").append(b);$("#table_cmd tbody tr:last").setValues(a,".cmdAttr");isset(a.type)&&$("#table_cmd tbody tr:last .cmdAttr[data-l1key=type]").value(init(a.type));
jeedom.cmd.changeType($("#table_cmd tbody tr:last"),init(a.subType));jeedom.cmd.execute({id:a.id,cache:0,notify:!1,success:function(a){d(a)}});jeedom.cmd.update[a.id]=function(a){d(a.display_value)};N_CMD++}"action"==init(a.type)&&(b='<tr class="cmd treegrid-'+N_CMD+'" data-cmd_id="'+init(a.id)+'">',b+="<td>",b+='<span class="cmdAttr" data-l1key="id"></span>',b+="</td>",b+="<td>",b+='<div class="row">',b+='<div class="col-sm-4">',b+='<a class="cmdAction btn btn-default btn-sm" data-l1key="chooseIcon" style="padding-left:5px;padding-right:5px;"><i class="fa fa-flag"></i>  Ic\u00f4ne</a>',
b+='<span class="cmdAttr" data-l1key="display" data-l2key="icon" style="margin-left:5px;"></span>',b+="</div>",b+='<div class="col-sm-8">',b+='<input class="cmdAttr form-control input-sm" data-l1key="name">',b+="</div>",b+="</div>",b+='<select class="cmdAttr form-control tooltips input-sm" data-l1key="value" style="display:none;margin-top:5px;margin-right:10px;" title="{{Valeur par d\u00e9faut de la commande}}">',b+='<option value="">Aucune</option>',b+="</select>",b+="</td>",b+="<td>",b+='<input class="cmdAttr form-control type input-sm" data-l1key="type" value="action" disabled style="margin-bottom:5px;width:120px;" />',
b+='<span class="cmdAttr subType" subType="'+init(a.subType)+'" style=""></span>',b+="</td>",b+="<td>",b+='<textarea class="cmdAttr form-control input-sm" data-l1key="configuration" data-l2key="topic" style="height:65px;"'+c+' placeholder="{{Topic}}"></textarea><br/>',b+="</td><td>",b+='<textarea class="cmdAttr form-control input-sm" data-l1key="configuration" data-l2key="request" style="height:30px;" '+c+' placeholder="{{Valeur}}"></textarea>',b+='<a class="btn btn-default btn-sm cursor listEquipementInfo" data-input="request" style="margin-top:5px;margin-left:5px;"><i class="fa fa-list-alt "></i> {{Rechercher \u00e9quipement}}</a>',
b+="</select></span>",b+="</td><td></td><td>",b+='<span><label class="checkbox-inline"><input type="checkbox" class="cmdAttr checkbox-inline" data-l1key="isVisible" checked/>{{Afficher}}</label></span><br> ',b+='<span><label class="checkbox-inline"><input type="checkbox" class="cmdAttr checkbox-inline" data-l1key="configuration" data-l2key="retain"/>{{Retain}}</label></span><br> ',b+='<span class="checkbox-inline">{{Qos}}: <input class="tooltips cmdAttr form-control input-sm" data-l1key="configuration" data-l2key="Qos" placeholder="{{Qos}}" title="{{Qos}}" style="width:50px;display:inline-block;"></span> ',
b+="</td>",b+="<td>",is_numeric(a.id)&&(b+='<a class="btn btn-default btn-xs cmdAction expertModeVisible" data-action="configure"><i class="fa fa-cogs"></i></a> ',b+='<a class="btn btn-default btn-xs cmdAction" data-action="test"><i class="fa fa-rss"></i> {{Tester}}</a>'),b+='<i class="fa fa-minus-circle pull-right cmdAction cursor" data-action="remove"></i></td>',b+="</tr>",$("#table_cmd tbody").append(b),b=$("#table_cmd tbody tr:last"),jeedom.eqLogic.builSelectCmd({id:$(".li_eqLogic.active").attr("data-eqLogic_id"),
filter:{type:"info"},error:function(a){$("#div_alert").showAlert({message:a.message,level:"danger"})},success:function(c){b.find(".cmdAttr[data-l1key=value]").append(c);b.setValues(a,".cmdAttr");jeedom.cmd.changeType(b,init(a.subType))}}),N_CMD++);$("#bt_json.active").length&&$(".tree").treegrid({expanderExpandedClass:"glyphicon glyphicon-minus",expanderCollapsedClass:"glyphicon glyphicon-plus"})}
$("body").off("jMQTT::cmdAdded").on("jMQTT::cmdAdded",function(a,d){a=0==$("#div_newCmdMsg.alert").length?"{{La commande}} <b>"+d.cmd_name+"</b> {{a \u00e9t\u00e9 ajout\u00e9e \u00e0 l'\u00e9quipement}} <b>"+d.eqlogic_name+"</b>.":"{{Plusieurs commandes ont \u00e9t\u00e9 ajout\u00e9e \u00e0 l'\u00e9quipement}} <b>"+d.eqlogic_name+"</b>.";modifyWithoutSave||$(".li_eqLogic.active").attr("data-eqLogic_id")!=d.eqlogic_id||0!=$('div[role="dialog"]').filter(":visible").length?$("#div_newCmdMsg").showAlert({message:a,
level:"warning"}):($("#div_newCmdMsg").showAlert({message:a+" {{La page va se r\u00e9actualiser automatiquement}}.",level:"warning"}),void 0===refreshTimeout&&(refreshTimeout=setTimeout(function(){refreshTimeout=void 0;$(".eqLogicAction[data-action=refreshPage]").click()},3E3)))});
function configureIncludeModeDisplay(a){1==a?($(".bt_changeIncludeMode:not(.card)").removeClass("btn-default").addClass("btn-success"),$(".bt_changeIncludeMode").attr("data-mode",1),$(".bt_changeIncludeMode.card span center").text("{{Arr\u00eater l'inclusion}}"),$(".bt_changeIncludeMode:not(.card)").html('<i class="fa fa-sign-in fa-rotate-90"></i> {{Arreter inclusion}}'),$(".bt_changeIncludeMode").addClass("include"),$("#div_inclusionModeMsg").showAlert({message:"{{Mode inclusion automatique pendant 2 \u00e0 3min. Cliquez sur le bouton pour forcer la sortie de ce mode avant.}}",
level:"warning"})):($(".bt_changeIncludeMode:not(.card)").addClass("btn-default").removeClass("btn-success btn-danger"),$(".bt_changeIncludeMode").attr("data-mode",0),$(".bt_changeIncludeMode:not(.card)").html('<i class="fa fa-sign-in fa-rotate-90"></i> {{Mode inclusion}}'),$(".bt_changeIncludeMode.card span center").text("{{Mode inclusion}}"),$(".bt_changeIncludeMode").removeClass("include"),$("#div_inclusionModeMsg").hideAlert())}
$(".bt_changeIncludeMode").on("click",function(){var a=$(this);1==a.attr("data-mode")?configureIncludeModeDisplay(0):configureIncludeModeDisplay(1);$.ajax({type:"POST",url:"plugins/jMQTT/core/ajax/jMQTT.ajax.php",data:{action:"setIncludeMode",state:a.attr("data-mode")},dataType:"json",error:function(a,c,b){handleAjaxError(a,c,b)},success:function(a){"ok"!=a.state&&$("#div_alert").showAlert({message:a.result,level:"danger"})}})});
$("body").off("jMQTT::disableIncludeMode").on("jMQTT::disableIncludeMode",function(a,d){configureIncludeModeDisplay(0)});
$("body").off("jMQTT::eqptAdded").on("jMQTT::eqptAdded",function(a,d){a="{{L'\u00e9quipement}} <b>"+d.eqlogic_name+"</b> {{vient d'\u00eatre inclu}}";modifyWithoutSave||void 0!=$(".li_eqLogic.active").attr("data-eqLogic_id")||0!=$('div[role="dialog"]').filter(":visible").length?$("#div_newEqptMsg").showAlert({message:a+".",level:"warning"}):($("#div_newEqptMsg").showAlert({message:a+". {{La page va se r\u00e9actualiser automatiquement}}.",level:"warning"}),void 0===refreshTimeout&&(refreshTimeout=
setTimeout(function(){refreshTimeout=void 0;window.location.reload()},3E3)))});
