var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};
$jscomp.findInternal=function(a,c,d){a instanceof String&&(a=String(a));for(var b=a.length,e=0;e<b;e++){var f=a[e];if(c.call(d,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,d){a!=Array.prototype&&a!=Object.prototype&&(a[c]=d.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,c,d,b){if(c){d=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var e=a[b];e in d||(d[e]={});d=d[e]}a=a[a.length-1];b=d[a];c=c(b);c!=b&&null!=c&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");$jscomp.checkStringArgs=function(a,c,d){if(null==a)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var b="";a;)if(a&1&&(b+=c),a>>>=1)c+=c;return b}},"es6","es3");var refreshTimeout,N_CMD;document.documentElement.style.setProperty("--logo-primary-color","#f8d800");window.addEventListener("popstate",function(a){null==a.state&&location.reload(!1)});
function callPluginAjax(a){$.ajax({async:!0,global:!1,type:"POST",url:"plugins/jMQTT/core/ajax/jMQTT.ajax.php",data:a.data,dataType:"json",error:function(a,d,b){handleAjaxError(a,d,b)},success:function(c){"ok"!=c.state?$("#div_alert").showAlert({message:c.result,level:"danger"}):"function"===typeof a.success&&a.success(c.result)}})}
function initPluginUrl(a,c,d){a=void 0===a?["id","saveSuccessFull","removeSuccessFull","hash"]:a;c=void 0===c?"":c;d=void 0===d?"":d;var b=getUrlVars(),e="index.php?",f;for(f in b)0>$.inArray(f,a)&&("?"!=e.substr(-1)&&(e+="&"),e+=f+"="+b[f].replace("#",""));""!=c&&(e+="&id="+c);""!=document.location.hash&&0>$.inArray("hash",a)&&(e+=document.location.hash);""!=d&&(e+=d);return e}
function refreshEqLogicPage(){function a(){void 0!=$("#ul_eqLogic .li_eqLogic.active").attr("data-eqLogic_id")?$("#ul_eqLogic .li_eqLogic.active").click():$(".eqLogicAction[data-action=returnToThumbnailDisplay]").click()}modifyWithoutSave?bootbox.confirm("{{La page a \u00e9t\u00e9 modifi\u00e9e. Etes-vous s\u00fbr de vouloir la recharger sans sauver ?}}",function(c){c&&a()}):a()}$(document).ready(function(){"#commandtab"==document.location.hash&&$("#menu-bar").show();history.replaceState({},"",url)});
$("#bt_addMQTTInfo").on("click",function(a){addCmdToTable({type:"info"});modifyWithoutSave=!0});$("#bt_addMQTTAction").on("click",function(a){addCmdToTable({type:"action"});modifyWithoutSave=!0});$(".eqLogicAction[data-action=healthMQTT]").on("click",function(){$("#md_modal").dialog({title:"{{Sant\u00e9 jMQTT}}"});$("#md_modal").load("index.php?v=d&plugin=jMQTT&modal=health").dialog("open")});
$("#table_cmd").delegate(".listEquipementAction","click",function(){var a=$(this);jeedom.cmd.getSelectModal({cmd:{type:"action"}},function(c){a.closest("tr").find(".cmdAttr[data-l1key=configuration][data-l2key="+a.attr("data-input")+"]").value(c.human)})});
$("#table_cmd").delegate(".listEquipementInfo","click",function(){var a=$(this);jeedom.cmd.getSelectModal({cmd:{type:"info"}},function(c){a.closest("tr").find(".cmdAttr[data-l1key=configuration][data-l2key="+a.data("input")+"]").atCaret("insert",c.human);modifyWithoutSave=!0})});$(".eqLogicAction[data-action=refreshPage]").on("click",refreshEqLogicPage);$("#bt_classic").on("click",function(){refreshEqLogicPage();$("#bt_classic").removeClass("btn-default").addClass("btn-primary");$("#bt_json").removeClass("btn-primary").addClass("btn-default")});
$("#bt_json").on("click",function(){refreshEqLogicPage();$("#bt_json").removeClass("btn-default").addClass("btn-primary");$("#bt_classic").removeClass("btn-primary").addClass("btn-default")});$('.nav-tabs a[href="#eqlogictab"],.nav-tabs a[href="#brokertab"]').on("click",function(){$("#menu-bar").hide()});$('.nav-tabs a[href="#commandtab"]').on("click",function(){$("#menu-bar").show()});
$('.nav-tabs a[role="tab"]').on("click",function(){document.location.hash!=$(this)[0].hash&&(url=initPluginUrl(["hash"],"",$(this)[0].hash),""==document.location.hash&&"#eqlogictab"==$(this)[0].hash?history.replaceState({hash:$(this)[0].hash},"",url):history.pushState({hash:$(this)[0].hash},"",url));"#brokertab"==$(this)[0].hash&&refreshDaemonInfo()});
$(".li_eqLogic,.eqLogicDisplayCard").on("click",function(){var a=getUrlVars("id"),c=$(this).attr("data-eqLogic_id"),d=document.location.hash;is_numeric(a)&&a==c||("#brokertab"==d&&"broker"!=$(this).attr("jmqtt_type")&&(d=""),url=initPluginUrl(["id","hash"],c,d),history.pushState({},"",url));"#brokertab"==d&&refreshDaemonInfo()});$(".eqLogicAction[data-action=returnToThumbnailDisplay]").on("click",function(){url=initPluginUrl();history.pushState({},"",url)});
1==getUrlVars("saveSuccessFull")&&($("#div_alert").showAlert({message:"{{Sauvegarde effectu\u00e9e avec succ\u00e8s}}",level:"success"}),history.replaceState({},"",initPluginUrl(["saveSuccessFull"])));1==getUrlVars("removeSuccessFull")&&($("#div_alert").showAlert({message:"{{Suppression effectu\u00e9e avec succ\u00e8s}}",level:"success"}),history.replaceState({},"",initPluginUrl(["removeSuccessFull"])));
$("#table_cmd").sortable({axis:"y",cursor:"move",items:".cmd",placeholder:"ui-state-highlight",tolerance:"intersect",forcePlaceholderSize:!0});
$(".eqLogicAction[data-action=add_jmqtt]").on("click",function(){if("undefined"===typeof $(this).attr("brkId"))var a={type:"broker",brkId:-1},c="{{Nom du broker ?}}";else a={type:"eqpt",brkId:$(this).attr("brkId")},c="{{Nom du module ?}}";bootbox.prompt(c,function(c){null!==c&&jeedom.eqLogic.save({type:eqType,eqLogics:[$.extend({name:c},a)],error:function(a){console.log(a.message);$("#div_alert").showAlert({message:a.message,level:"danger"})},success:function(a){var b=initPluginUrl();modifyWithoutSave=
!1;b+="&id="+a.id+"&saveSuccessFull=1";loadPage(b)}})})});
$(".eqLogicAction[data-action=remove_jmqtt]").on("click",function(){function a(){jeedom.eqLogic.remove({type:eqType,id:$(".eqLogicAttr[data-l1key=id]").value(),error:function(a){$("#div_alert").showAlert({message:a.message,level:"danger"})},success:function(){var a=initPluginUrl();modifyWithoutSave=!1;loadPage(a+"&removeSuccessFull=1")}})}if(void 0!=$(".eqLogicAttr[data-l1key=id]").value()){var c="broker"==$(".eqLogicAttr[data-l2key=type]").value()?"broker":"module";bootbox.confirm("{{Etes-vous s\u00fbr de vouloir supprimer le }}"+
c+" <b>"+$(".eqLogicAttr[data-l1key=name]").value()+"</b> ?",function(d){d&&("broker"==c?bootbox.confirm('<table><tr><td style="vertical-align:middle;font-size:2em;padding-right:10px"><span class="label label-warning"><i class="fa fa-warning"</i></span></td><td style="vertical-align:middle">{{Tous les modules associ\u00e9s au broker vont \u00eatre supprim\u00e9s}}...<br><b>{{\u00cates vous s\u00fbr ?}}</b></td></tr></table>',function(b){b&&a()}):a())})}else $("#div_alert").showAlert({message:"{{Veuillez d'abord s\u00e9lectionner un}} "+
eqType,level:"danger"})});
function printEqLogic(a){function c(a){a=parseInt(a).toString(36);3>a.length&&(a="0".repeat(3-a.length)+a);return a}function d(b){if(void 0!=b.sOrder)return b.sOrder;var e="";void 0!=b.configuration.jParent&&0<=b.configuration.jParent&&(e=a.cmd.filter(function(a){return a.id==b.configuration.jParent}),e=d(e[0]));sOrder=void 0==b.configuration.jOrder||0>b.configuration.jOrder?c(b.order):c(b.configuration.jOrder);return e+sOrder}if($("#bt_json.active").length){N_CMD=1;for(var b=$jscomp.makeIterator(a.cmd),
e=b.next();!e.done;e=b.next())e=e.value,e.sOrder=d(e);a.cmd.sort(function(a,b){return a.sOrder<b.sOrder?-1:a.sOrder>b.sOrder?1:0});$("#table_cmd").sortable("disable");$("#table_cmd th:first").width("120px")}else $("#table_cmd").sortable("enable"),$("#table_cmd th:first").width("50px");"broker"==a.configuration.type?($(".typ-std").hide(),$(".typ-brk").show(),$("#sel_icon_div").css("visibility","hidden"),$("#mqtttopic").prop("readonly",!0),b="jMQTT_"+(a.name.replace(" ","_")||"jeedom"),$("input[name=rd_logupdate]").attr("data-l1key",
"log::level::"+b),$(".bt_plugin_conf_view_log").attr("data-log",b),$(".bt_plugin_conf_view_log").html('<i class="fa fa fa-file-text-o"></i> '+b),jeedom.config.load({configuration:$("#div_broker_log").getValues(".configKey")[0],plugin:"jMQTT",error:function(a){$("#div_alert").showAlert({message:a.message,level:"danger"})},success:function(a){$("#div_broker_log").setValues(a,".configKey")}})):($(".typ-brk").hide(),$(".typ-std").show(),$("#sel_icon_div").css("visibility","visible"),$("#mqtttopic").prop("readonly",
!1))}function saveEqLogic(a){var c=$("#div_broker_log").getValues(".configKey")[0];$.isEmptyObject(c)||(a.loglevel=c);return a}
function addCmdToTable(a){isset(a)||(a={configuration:{}});isset(a.configuration)||(a.configuration={});if("info"==init(a.type)){var c=function(b){$(".cmd[data-cmd_id="+a.id+"] .form-control[data-key=value]").value(b)},d="1"==init(a.configuration.virtualAction)?"disabled":"",b='<tr class="cmd';$("#bt_json.active").length&&(b+=" treegrid-"+N_CMD,0<=a.configuration.jParent&&(b+=" treegrid-parent-"+$(".cmd[data-cmd_id="+a.configuration.jParent+"]").attr("class").split("treegrid-")[1]));b+='" data-cmd_id="'+
init(a.id)+'">';b+='<td><span class="cmdAttr" data-l1key="id"></span>';b=$("#bt_json.active").length?b+'<span style="display:none;" class="cmdAttr" data-l1key="order"></span></td>':b+"</td>";b+='<td><textarea class="cmdAttr form-control input-sm" data-l1key="name" style="height:65px;" placeholder="{{Nom de l\'info}}" /></td>';b+="<td>";b+='<input class="cmdAttr form-control type input-sm" data-l1key="type" value="info" disabled style="margin-bottom:5px;width:120px;" />';b+='<span class="cmdAttr subType" subType="'+
init(a.subType)+'"></span>';b+="</td><td>";b+='<textarea class="cmdAttr form-control input-sm" data-l1key="configuration" data-l2key="topic" style="height:65px;" '+d+' placeholder="{{Topic}}" readonly=true />';b+="</td><td>";b+='<textarea class="form-control input-sm" data-key="value" style="height:65px;" '+d+' placeholder="{{Valeur}}" readonly=true />';b+="</td><td>";b+='<input class="cmdAttr form-control input-sm" data-l1key="unite" placeholder="{{Unit\u00e9}}"></td><td>';b+='<span><label class="checkbox-inline"><input type="checkbox" class="cmdAttr checkbox-inline" data-l1key="isHistorized" checked/>{{Historiser}}</label></span> ';
b+='<span><label class="checkbox-inline"><input type="checkbox" class="cmdAttr checkbox-inline" data-l1key="isVisible" checked/>{{Afficher}}</label></span> ';b+='<span><label class="checkbox-inline"><input type="checkbox" class="cmdAttr checkbox-inline" data-l1key="display" data-l2key="invertBinary"/>{{Inverser}}</label></span> ';b+='<span><label class="checkbox-inline"><input type="checkbox" class="cmdAttr checkbox-inline" data-l1key="configuration" data-l2key="parseJson"/>{{parseJson}}</label></span> ';
b+="</td>";b+="<td>";is_numeric(a.id)&&(b+='<a class="btn btn-default btn-xs cmdAction" data-action="configure"><i class="fa fa-cogs"></i></a> ',b+='<a class="btn btn-default btn-xs cmdAction" data-action="test"><i class="fa fa-rss"></i> {{Tester}}</a>');void 0==a.configuration.irremovable&&(b+='<i class="fa fa-minus-circle pull-right cmdAction cursor" data-action="remove"></i>');b+='<input style="width:82%;margin-bottom:2px;" class="tooltips cmdAttr form-control input-sm" data-l1key="cache" data-l2key="lifetime" placeholder="{{Lifetime cache}}" title="{{Lifetime cache}}">';
b+='<input class="tooltips cmdAttr form-control input-sm" data-l1key="configuration" data-l2key="minValue" placeholder="{{Min}}" title="{{Min}}" style="width:40%;display:inline-block;"> ';b+='<input class="tooltips cmdAttr form-control input-sm" data-l1key="configuration" data-l2key="maxValue" placeholder="{{Max}}" title="{{Max}}" style="width:40%;display:inline-block;">';b+="</td></tr>";$("#table_cmd tbody").append(b);$("#table_cmd tbody tr:last").setValues(a,".cmdAttr");isset(a.type)&&$("#table_cmd tbody tr:last .cmdAttr[data-l1key=type]").value(init(a.type));
jeedom.cmd.changeType($("#table_cmd tbody tr:last"),init(a.subType));jeedom.cmd.execute({id:a.id,cache:0,notify:!1,success:function(a){c(a)}});jeedom.cmd.update[a.id]=function(a){c(a.display_value)};N_CMD++}"action"==init(a.type)&&(b='<tr class="cmd treegrid-'+N_CMD+'" data-cmd_id="'+init(a.id)+'">',b+="<td>",b+='<span class="cmdAttr" data-l1key="id"></span>',b+="</td>",b+="<td>",b+='<div class="row">',b+='<div class="col-sm-4">',b+='<a class="cmdAction btn btn-default btn-sm" data-l1key="chooseIcon" style="padding-left:5px;padding-right:5px;"><i class="fa fa-flag"></i>  Ic\u00f4ne</a>',
b+='<span class="cmdAttr" data-l1key="display" data-l2key="icon" style="margin-left:5px;"></span>',b+="</div>",b+='<div class="col-sm-8">',b+='<input class="cmdAttr form-control input-sm" data-l1key="name">',b+="</div>",b+="</div>",b+='<select class="cmdAttr form-control tooltips input-sm" data-l1key="value" style="display:none;margin-top:5px;margin-right:10px;" title="{{Valeur par d\u00e9faut de la commande}}">',b+='<option value="">Aucune</option>',b+="</select>",b+="</td>",b+="<td>",b+='<input class="cmdAttr form-control type input-sm" data-l1key="type" value="action" disabled style="margin-bottom:5px;width:120px;" />',
b+='<span class="cmdAttr subType" subType="'+init(a.subType)+'" style=""></span>',b+="</td>",b+="<td>",b+='<textarea class="cmdAttr form-control input-sm" data-l1key="configuration" data-l2key="topic" style="height:65px;"'+d+' placeholder="{{Topic}}"></textarea><br/>',b+="</td><td>",b+='<textarea class="cmdAttr form-control input-sm" data-l1key="configuration" data-l2key="request" style="height:30px;" '+d+' placeholder="{{Valeur}}"></textarea>',b+='<a class="btn btn-default btn-sm cursor listEquipementInfo" data-input="request" style="margin-top:5px;margin-left:5px;"><i class="fa fa-list-alt "></i> {{Rechercher \u00e9quipement}}</a>',
b+="</select></span>",b+="</td><td></td><td>",b+='<span><label class="checkbox-inline"><input type="checkbox" class="cmdAttr checkbox-inline" data-l1key="isVisible" checked/>{{Afficher}}</label></span><br> ',b+='<span><label class="checkbox-inline"><input type="checkbox" class="cmdAttr checkbox-inline" data-l1key="configuration" data-l2key="retain"/>{{Retain}}</label></span><br> ',b+='<span class="checkbox-inline">{{Qos}}: <input class="tooltips cmdAttr form-control input-sm" data-l1key="configuration" data-l2key="Qos" placeholder="{{Qos}}" title="{{Qos}}" style="width:50px;display:inline-block;"></span> ',
b+="</td>",b+="<td>",is_numeric(a.id)&&(b+='<a class="btn btn-default btn-xs cmdAction expertModeVisible" data-action="configure"><i class="fa fa-cogs"></i></a> ',b+='<a class="btn btn-default btn-xs cmdAction" data-action="test"><i class="fa fa-rss"></i> {{Tester}}</a>'),b+='<i class="fa fa-minus-circle pull-right cmdAction cursor" data-action="remove"></i></td>',b+="</tr>",$("#table_cmd tbody").append(b),b=$("#table_cmd tbody tr:last"),jeedom.eqLogic.builSelectCmd({id:$(".li_eqLogic.active").attr("data-eqLogic_id"),
filter:{type:"info"},error:function(a){$("#div_alert").showAlert({message:a.message,level:"danger"})},success:function(c){b.find(".cmdAttr[data-l1key=value]").append(c);b.setValues(a,".cmdAttr");jeedom.cmd.changeType(b,init(a.subType))}}),N_CMD++);$("#bt_json.active").length&&$(".tree").treegrid({expanderExpandedClass:"glyphicon glyphicon-minus",expanderCollapsedClass:"glyphicon glyphicon-plus"})}
$("body").off("jMQTT::cmdAdded").on("jMQTT::cmdAdded",function(a,c){a=0==$("#div_newCmdMsg.alert").length?"{{La commande}} <b>"+c.cmd_name+"</b> {{a \u00e9t\u00e9 ajout\u00e9e \u00e0 l'\u00e9quipement}} <b>"+c.eqlogic_name+"</b>.":"{{Plusieurs commandes ont \u00e9t\u00e9 ajout\u00e9e \u00e0 l'\u00e9quipement}} <b>"+c.eqlogic_name+"</b>.";modifyWithoutSave||$(".li_eqLogic.active").attr("data-eqLogic_id")!=c.eqlogic_id||0!=$('div[role="dialog"]').filter(":visible").length?$("#div_newCmdMsg").showAlert({message:a,
level:"warning"}):($("#div_newCmdMsg").showAlert({message:a+" {{La page va se r\u00e9actualiser automatiquement}}.",level:"warning"}),void 0===refreshTimeout&&(refreshTimeout=setTimeout(function(){refreshTimeout=void 0;$(".eqLogicAction[data-action=refreshPage]").click()},3E3)))});
function configureIncludeModeDisplay(a,c){1==c?($(".eqLogicAction[data-action=changeIncludeMode][brkId="+a+"]").attr("data-mode",1),$(".eqLogicAction[data-action=changeIncludeMode][brkId="+a+"].card span").text("{{Arr\u00eater l'inclusion}}"),$(".eqLogicAction[data-action=changeIncludeMode][brkId="+a+"]").addClass("include"),$("#div_inclusionModeMsg").showAlert({message:"{{Mode inclusion automatique pendant 2 \u00e0 3min. Cliquez sur le bouton pour forcer la sortie de ce mode avant.}}",level:"warning"})):
($(".eqLogicAction[data-action=changeIncludeMode][brkId="+a+"]").attr("data-mode",0),$(".eqLogicAction[data-action=changeIncludeMode][brkId="+a+"].card span").text("{{Mode inclusion}}"),$(".eqLogicAction[data-action=changeIncludeMode][brkId="+a+"]").removeClass("include"),$("#div_inclusionModeMsg").hideAlert())}
function setIncludeModeActivation(a,c){if("ok"==c)$(".eqLogicAction[data-action=changeIncludeMode][brkId="+a+"]").removeClass("disableCard").on("click",changeIncludeMode);else $(".eqLogicAction[data-action=changeIncludeMode][brkId="+a+"]").addClass("disableCard").unbind()}
function changeIncludeMode(){var a=$(this);1==a.attr("data-mode")?configureIncludeModeDisplay(a.attr("brkId"),0):configureIncludeModeDisplay(a.attr("brkId"),1);callPluginAjax({data:{action:"changeIncludeMode",mode:a.attr("data-mode"),id:a.attr("brkId")}})}
$("body").off("jMQTT::EventState").on("jMQTT::EventState",function(a,c){showDaemonInfo(c);setIncludeModeActivation(c.brkId,c.state);$('.eqLogicDisplayCard[jmqtt_type="broker"][data-eqlogic_id="'+c.brkId+'"] img').attr("src","plugins/jMQTT/resources/images/node_broker_"+c.state+".svg")});$("body").off("jMQTT::disableIncludeMode").on("jMQTT::disableIncludeMode",function(a,c){configureIncludeModeDisplay(c.brkId,0)});
$("body").off("jMQTT::eqptAdded").on("jMQTT::eqptAdded",function(a,c){a="{{L'\u00e9quipement}} <b>"+c.eqlogic_name+"</b> {{vient d'\u00eatre inclu}}";modifyWithoutSave||void 0!=$(".li_eqLogic.active").attr("data-eqLogic_id")||0!=$('div[role="dialog"]').filter(":visible").length?$("#div_newEqptMsg").showAlert({message:a+".",level:"warning"}):($("#div_newEqptMsg").showAlert({message:a+". {{La page va se r\u00e9actualiser automatiquement}}.",level:"warning"}),void 0===refreshTimeout&&(refreshTimeout=
setTimeout(function(){refreshTimeout=void 0;window.location.reload()},3E3)))});
